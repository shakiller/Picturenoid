<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Игра с физикой отскоков</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      touch-action: none;
    }
    .container {
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      flex: 1;
    }
    header {
      text-align: center;
      margin-bottom: 10px;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    .game-container {
      position: relative;
      background: #222;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      width: 100%;
      flex: 1;
      max-height: 60vh;
    }
    canvas {
      display: block;
      background: #111;
      width: 100%;
      height: 100%;
    }
    .ui-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .stats {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .controls {
      display: flex;
      gap: 10px;
      width: 100%;
      justify-content: center;
    }
    button {
      padding: 12px 20px;
      background: #4a4af0;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
      flex: 1;
      max-width: 140px;
    }
    button:hover {
      background: #5a5aff;
    }
    button:active {
      transform: scale(0.95);
    }
    button#pauseBtn.paused {
      background: #f04a4a;
    }
    button#pauseBtn.paused:hover {
      background: #ff5a5a;
    }
    .level-selector {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      width: 100%;
    }
    .level-selector h2 {
      margin-bottom: 10px;
      text-align: center;
      font-size: 1.3rem;
    }
    .level-list {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 5px;
    }
    .level-item {
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .level-item:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .level-item.active {
      background: #4a4af0;
    }
    .instructions {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      width: 100%;
      font-size: 0.9rem;
    }
    .instructions h2 {
      margin-bottom: 8px;
      font-size: 1.2rem;
    }
    .instructions ul {
      margin-left: 15px;
    }
    .instructions li {
      margin-bottom: 5px;
    }
    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      display: none;
      width: 80%;
      max-width: 300px;
    }
    .game-over h2 {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
    .game-over p {
      font-size: 1rem;
      margin-bottom: 15px;
    }
    .touch-controls {
      position: absolute;
      bottom: 10px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 15px;
      pointer-events: none;
    }
    .touch-btn {
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      pointer-events: auto;
      touch-action: manipulation;
    }
    .touch-btn:active {
      background: rgba(255, 255, 255, 0.4);
    }
    @media (max-height: 700px) {
      .instructions {
        display: none;
      }
      .game-container {
        max-height: 70vh;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Физика Отскоков</h1>
      <p>Разбей все фигуры!</p>
    </header>
    
    <div class="game-container">
      <canvas id="gameCanvas"></canvas>
      <div class="ui-overlay">
        <div class="stats">
          <div>Счет: <span id="score">0</span></div>
          <div>Фигур: <span id="remainingShapes">0</span></div>
        </div>
        <div class="touch-controls">
          <div class="touch-btn" id="leftBtn">←</div>
          <div class="touch-btn" id="rightBtn">→</div>
        </div>
      </div>
      <div class="game-over" id="gameOver">
        <h2>Уровень пройден!</h2>
        <p>Счет: <span id="finalScore">0</span></p>
        <button id="nextLevelBtn">Далее</button>
      </div>
    </div>
    
    <div class="level-selector">
      <h2>Уровни</h2>
      <div class="level-list" id="levelList">
        <!-- Уровни будут загружены через JS -->
      </div>
      <div class="controls">
        <button id="resetBtn">Заново</button>
        <button id="pauseBtn">Пауза</button>
      </div>
    </div>
    
    <div class="instructions">
      <h2>Как играть:</h2>
      <ul>
        <li>Двигайте платформу кнопками внизу</li>
        <li>Отбивайте шарик и разбивайте фигуры</li>
        <li>Каждая фигура дает очки</li>
        <li>Цель - разбить все фигуры</li>
      </ul>
    </div>
  </div>

  <script>
    // Уровни игры
    const levels = {
      "level1": {
        name: "Простой уровень",
        ball: {
          radius: 8,
          initialPosition: {x: 150, y: 300},
          initialVelocity: {x: 3, y: -4}
        },
        paddle: {
          width: 80,
          height: 15,
          speed: 8,
          color: "#4a4af0"
        },
        shapes: [
          {
            type: "rectangle",
            id: "block1",
            x: 50,
            y: 80,
            width: 60,
            height: 20,
            color: "#ff4444",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block2",
            x: 130,
            y: 80,
            width: 60,
            height: 20,
            color: "#44ff44",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block3",
            x: 210,
            y: 80,
            width: 60,
            height: 20,
            color: "#4444ff",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block4",
            x: 290,
            y: 80,
            width: 60,
            height: 20,
            color: "#ffff44",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block5",
            x: 90,
            y: 120,
            width: 60,
            height: 20,
            color: "#ff44ff",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block6",
            x: 170,
            y: 120,
            width: 60,
            height: 20,
            color: "#44ffff",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block7",
            x: 250,
            y: 120,
            width: 60,
            height: 20,
            color: "#ff9966",
            health: 2,
            score: 20
          }
        ],
        bounds: {
          left: 0,
          top: 0,
          right: 400,
          bottom: 500,
          bounceFactor: 0.95
        }
      },
      "level2": {
        name: "Средний уровень",
        ball: {
          radius: 8,
          initialPosition: {x: 200, y: 350},
          initialVelocity: {x: 4, y: -5}
        },
        paddle: {
          width: 70,
          height: 15,
          speed: 7,
          color: "#4a4af0"
        },
        shapes: [
          {
            type: "rectangle",
            id: "block1",
            x: 30,
            y: 60,
            width: 50,
            height: 20,
            color: "#ff4444",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block2",
            x: 100,
            y: 60,
            width: 50,
            height: 20,
            color: "#44ff44",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block3",
            x: 170,
            y: 60,
            width: 50,
            height: 20,
            color: "#4444ff",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block4",
            x: 240,
            y: 60,
            width: 50,
            height: 20,
            color: "#ffff44",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block5",
            x: 310,
            y: 60,
            width: 50,
            height: 20,
            color: "#ff44ff",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block6",
            x: 60,
            y: 100,
            width: 50,
            height: 20,
            color: "#44ffff",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block7",
            x: 130,
            y: 100,
            width: 50,
            height: 20,
            color: "#ff9966",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block8",
            x: 200,
            y: 100,
            width: 50,
            height: 20,
            color: "#99ff66",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block9",
            x: 270,
            y: 100,
            width: 50,
            height: 20,
            color: "#6699ff",
            health: 2,
            score: 20
          }
        ],
        bounds: {
          left: 0,
          top: 0,
          right: 400,
          bottom: 500,
          bounceFactor: 0.95
        }
      },
      "level3": {
        name: "Сложный уровень",
        ball: {
          radius: 8,
          initialPosition: {x: 200, y: 400},
          initialVelocity: {x: 5, y: -5}
        },
        paddle: {
          width: 60,
          height: 15,
          speed: 6,
          color: "#4a4af0"
        },
        shapes: [
          {
            type: "rectangle",
            id: "block1",
            x: 20,
            y: 50,
            width: 45,
            height: 20,
            color: "#ff4444",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block2",
            x: 75,
            y: 50,
            width: 45,
            height: 20,
            color: "#44ff44",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block3",
            x: 130,
            y: 50,
            width: 45,
            height: 20,
            color: "#4444ff",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block4",
            x: 185,
            y: 50,
            width: 45,
            height: 20,
            color: "#ffff44",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block5",
            x: 240,
            y: 50,
            width: 45,
            height: 20,
            color: "#ff44ff",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block6",
            x: 295,
            y: 50,
            width: 45,
            height: 20,
            color: "#44ffff",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block7",
            x: 50,
            y: 90,
            width: 45,
            height: 20,
            color: "#ff9966",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block8",
            x: 105,
            y: 90,
            width: 45,
            height: 20,
            color: "#99ff66",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block9",
            x: 160,
            y: 90,
            width: 45,
            height: 20,
            color: "#6699ff",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block10",
            x: 215,
            y: 90,
            width: 45,
            height: 20,
            color: "#ff66cc",
            health: 2,
            score: 20
          },
          {
            type: "rectangle",
            id: "block11",
            x: 270,
            y: 90,
            width: 45,
            height: 20,
            color: "#66ffcc",
            health: 1,
            score: 10
          },
          {
            type: "rectangle",
            id: "block12",
            x: 100,
            y: 130,
            width: 45,
            height: 20,
            color: "#cc66ff",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block13",
            x: 155,
            y: 130,
            width: 45,
            height: 20,
            color: "#ffcc66",
            health: 3,
            score: 30
          },
          {
            type: "rectangle",
            id: "block14",
            x: 210,
            y: 130,
            width: 45,
            height: 20,
            color: "#66ccff",
            health: 3,
            score: 30
          }
        ],
        bounds: {
          left: 0,
          top: 0,
          right: 400,
          bottom: 500,
          bounceFactor: 0.95
        }
      }
    };

    // Класс для обработки физики
    class PhysicsEngine {
      // Столкновение круга с прямоугольником
      circleRectCollision(ball, rect) {
        // Ближайшая точка на прямоугольнике к центру шара
        let closestX = Math.max(rect.x, Math.min(ball.x, rect.x + rect.width));
        let closestY = Math.max(rect.y, Math.min(ball.y, rect.y + rect.height));
        
        // Расстояние от центра шара до ближайшей точки
        const distanceX = ball.x - closestX;
        const distanceY = ball.y - closestY;
        const distance = Math.sqrt(distanceX * distanceX + distanceY * distanceY);
        
        return distance < ball.radius;
      }

      // Расчет нормали отскока от прямоугольника
      calculateRectBounceNormal(ball, rect) {
        // Определяем, с какой стороны произошло столкновение
        const ballCenterX = ball.x;
        const ballCenterY = ball.y;
        
        // Расстояния до каждой стороны прямоугольника
        const distLeft = Math.abs(ballCenterX - rect.x);
        const distRight = Math.abs(ballCenterX - (rect.x + rect.width));
        const distTop = Math.abs(ballCenterY - rect.y);
        const distBottom = Math.abs(ballCenterY - (rect.y + rect.height));
        
        // Находим минимальное расстояние
        const minDist = Math.min(distLeft, distRight, distTop, distBottom);
        
        // Определяем нормаль в зависимости от ближайшей стороны
        if (minDist === distLeft) return { x: -1, y: 0 };
        if (minDist === distRight) return { x: 1, y: 0 };
        if (minDist === distTop) return { x: 0, y: -1 };
        return { x: 0, y: 1 };
      }

      // Обработка отскока
      handleBounce(ball, normal) {
        const dotProduct = ball.vx * normal.x + ball.vy * normal.y;
        
        // Коэффициент отскока
        const bounceFactor = 0.95;
        
        ball.vx = ball.vx - 2 * dotProduct * normal.x * bounceFactor;
        ball.vy = ball.vy - 2 * dotProduct * normal.y * bounceFactor;
        
        // Коррекция позиции чтобы избежать залипания
        const overlap = ball.radius + 2;
        ball.x += normal.x * overlap;
        ball.y += normal.y * overlap;
      }

      // Отскок от платформы с учетом угла
      handlePaddleBounce(ball, paddle) {
        // Вычисляем относительное положение удара по платформе (-1 до 1)
        const hitPos = (ball.x - paddle.x) / paddle.width - 0.5;
        
        // Угол отскока зависит от позиции удара
        const angle = hitPos * Math.PI / 3; // Максимальный угол 60 градусов
        
        // Скорость шарика
        const speed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
        
        // Новое направление
        ball.vx = Math.sin(angle) * speed;
        ball.vy = -Math.cos(angle) * speed;
        
        // Коррекция позиции
        ball.y = paddle.y - ball.radius;
      }
    }

    // Основной класс игры
    class Game {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.physics = new PhysicsEngine();
        this.isPaused = false;
        this.currentLevel = 'level1';
        this.score = 0;
        
        // Установка размеров холста
        this.resizeCanvas();
        window.addEventListener('resize', () => this.resizeCanvas());
        
        // Загрузка уровня
        this.loadLevel(this.currentLevel);
        
        // Инициализация шарика
        this.resetBall();
        
        // Управление платформой
        this.paddleMovingLeft = false;
        this.paddleMovingRight = false;
        
        // Запуск игрового цикла
        this.lastTime = 0;
        this.animate(0);
        
        // Обработчики событий
        this.setupEventListeners();
      }
      
      resizeCanvas() {
        const container = this.canvas.parentElement;
        this.canvas.width = container.clientWidth;
        this.canvas.height = container.clientHeight;
        
        // Обновляем границы уровня под новый размер холста
        if (this.bounds) {
          this.bounds.right = this.canvas.width;
          this.bounds.bottom = this.canvas.height;
        }
      }
      
      loadLevel(levelId) {
        this.currentLevel = levelId;
        const level = levels[levelId];
        
        // Копируем фигуры, чтобы не изменять оригинальные данные
        this.shapes = JSON.parse(JSON.stringify(level.shapes));
        
        // Добавляем здоровье и активность
        this.shapes.forEach(shape => {
          shape.initialHealth = shape.health;
          shape.active = true;
        });
        
        this.bounds = {...level.bounds};
        this.bounds.right = this.canvas.width;
        this.bounds.bottom = this.canvas.height;
        
        // Инициализация платформы
        this.paddle = {
          x: (this.canvas.width - level.paddle.width) / 2,
          y: this.canvas.height - 30,
          width: level.paddle.width,
          height: level.paddle.height,
          speed: level.paddle.speed,
          color: level.paddle.color
        };
        
        this.levelName = level.name;
        
        // Сброс шарика
        this.resetBall();
        
        // Обновление UI
        this.updateUI();
        
        // Скрыть экран завершения игры
        document.getElementById('gameOver').style.display = 'none';
      }
      
      resetBall() {
        const level = levels[this.currentLevel];
        this.ball = {
          x: level.ball.initialPosition.x,
          y: level.ball.initialPosition.y,
          vx: level.ball.initialVelocity.x,
          vy: level.ball.initialVelocity.y,
          radius: level.ball.radius
        };
      }
      
      setupEventListeners() {
        document.getElementById('resetBtn').addEventListener('click', () => {
          this.resetBall();
          this.loadLevel(this.currentLevel);
          this.score = 0;
          this.updateUI();
        });
        
        document.getElementById('pauseBtn').addEventListener('click', () => {
          this.togglePause();
        });
        
        document.getElementById('nextLevelBtn').addEventListener('click', () => {
          const levelIds = Object.keys(levels);
          const currentIndex = levelIds.indexOf(this.currentLevel);
          const nextIndex = (currentIndex + 1) % levelIds.length;
          this.loadLevel(levelIds[nextIndex]);
          this.updateLevelList();
        });
        
        // Кнопки управления для мобильных устройств
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
          e.preventDefault();
          this.paddleMovingLeft = true;
        });
        
        document.getElementById('leftBtn').addEventListener('touchend', (e) => {
          e.preventDefault();
          this.paddleMovingLeft = false;
        });
        
        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
          e.preventDefault();
          this.paddleMovingRight = true;
        });
        
        document.getElementById('rightBtn').addEventListener('touchend', (e) => {
          e.preventDefault();
          this.paddleMovingRight = false;
        });
        
        // Управление с клавиатуры для тестирования
        document.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft') this.paddleMovingLeft = true;
          if (e.key === 'ArrowRight') this.paddleMovingRight = true;
        });
        
        document.addEventListener('keyup', (e) => {
          if (e.key === 'ArrowLeft') this.paddleMovingLeft = false;
          if (e.key === 'ArrowRight') this.paddleMovingRight = false;
        });
        
        // Инициализация списка уровней
        this.updateLevelList();
      }
      
      updateLevelList() {
        const levelList = document.getElementById('levelList');
        levelList.innerHTML = '';
        
        Object.keys(levels).forEach(levelId => {
          const level = levels[levelId];
          const levelItem = document.createElement('div');
          levelItem.className = 'level-item';
          if (levelId === this.currentLevel) {
            levelItem.classList.add('active');
          }
          levelItem.textContent = level.name;
          levelItem.addEventListener('click', () => {
            this.loadLevel(levelId);
            this.updateLevelList();
          });
          levelList.appendChild(levelItem);
        });
      }
      
      togglePause() {
        this.isPaused = !this.isPaused;
        const pauseBtn = document.getElementById('pauseBtn');
        
        if (this.isPaused) {
          pauseBtn.textContent = 'Продолжить';
          pauseBtn.classList.add('paused');
        } else {
          pauseBtn.textContent = 'Пауза';
          pauseBtn.classList.remove('paused');
          this.animate(0);
        }
      }
      
      update(deltaTime) {
        if (this.isPaused) return;
        
        // Движение платформы
        if (this.paddleMovingLeft) {
          this.paddle.x = Math.max(0, this.paddle.x - this.paddle.speed);
        }
        if (this.paddleMovingRight) {
          this.paddle.x = Math.min(this.canvas.width - this.paddle.width, this.paddle.x + this.paddle.speed);
        }
        
        // Движение шара
        this.ball.x += this.ball.vx;
        this.ball.y += this.ball.vy;

        // Проверка столкновений с границами
        if (this.ball.x - this.ball.radius < this.bounds.left) {
          this.ball.vx = Math.abs(this.ball.vx) * this.bounds.bounceFactor;
          this.ball.x = this.bounds.left + this.ball.radius;
        } else if (this.ball.x + this.ball.radius > this.bounds.right) {
          this.ball.vx = -Math.abs(this.ball.vx) * this.bounds.bounceFactor;
          this.ball.x = this.bounds.right - this.ball.radius;
        }
        
        if (this.ball.y - this.ball.radius < this.bounds.top) {
          this.ball.vy = Math.abs(this.ball.vy) * this.bounds.bounceFactor;
          this.ball.y = this.bounds.top + this.ball.radius;
        } else if (this.ball.y + this.ball.radius > this.bounds.bottom) {
          // Шарик ушел за нижнюю границу - перезапуск
          this.resetBall();
          return;
        }

        // Проверка столкновения с платформой
        if (this.physics.circleRectCollision(this.ball, this.paddle)) {
          this.physics.handlePaddleBounce(this.ball, this.paddle);
        }

        // Проверка столкновений с фигурами
        for (let i = 0; i < this.shapes.length; i++) {
          const shape = this.shapes[i];
          if (!shape.active) continue;
          
          if (this.physics.circleRectCollision(this.ball, shape)) {
            const normal = this.physics.calculateRectBounceNormal(this.ball, shape);
            this.physics.handleBounce(this.ball, normal);
            
            // Уменьшаем здоровье фигуры
            shape.health--;
            
            // Если здоровье закончилось, деактивируем фигуру
            if (shape.health <= 0) {
              shape.active = false;
              this.score += shape.score;
            }
            
            break; // Обрабатываем только одно столкновение за кадр
          }
        }
        
        // Обновление UI
        this.updateUI();
        
        // Проверка завершения уровня
        const activeShapes = this.shapes.filter(shape => shape.active);
        if (activeShapes.length === 0) {
          this.showGameOver();
        }
      }
      
      updateUI() {
        document.getElementById('score').textContent = this.score;
        
        const activeShapes = this.shapes.filter(shape => shape.active);
        document.getElementById('remainingShapes').textContent = activeShapes.length;
      }
      
      showGameOver() {
        const gameOver = document.getElementById('gameOver');
        document.getElementById('finalScore').textContent = this.score;
        
        gameOver.style.display = 'block';
        this.isPaused = true;
        document.getElementById('pauseBtn').textContent = 'Продолжить';
        document.getElementById('pauseBtn').classList.add('paused');
      }
      
      draw() {
        // Очистка холста
        this.ctx.fillStyle = '#111';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Рисование платформы
        this.ctx.fillStyle = this.paddle.color;
        this.ctx.fillRect(this.paddle.x, this.paddle.y, this.paddle.width, this.paddle.height);
        
        // Рисование фигур
        this.shapes.forEach(shape => {
          if (!shape.active) return;
          
          // Прозрачность в зависимости от здоровья
          const alpha = shape.health / shape.initialHealth;
          this.ctx.globalAlpha = alpha;
          
          this.ctx.fillStyle = shape.color;
          this.ctx.fillRect(shape.x, shape.y, shape.width, shape.height);
          
          this.ctx.globalAlpha = 1;
        });
        
        // Рисование шарика
        this.ctx.fillStyle = '#ff4444';
        this.ctx.beginPath();
        this.ctx.arc(this.ball.x, this.ball.y, this.ball.radius, 0, Math.PI * 2);
        this.ctx.fill();
        
        // Рисование границ
        this.ctx.strokeStyle = '#444';
        this.ctx.lineWidth = 2;
        this.ctx.strokeRect(0, 0, this.canvas.width, this.canvas.height);
      }
      
      animate(timestamp) {
        const deltaTime = timestamp - this.lastTime;
        this.lastTime = timestamp;
        
        this.update(deltaTime);
        this.draw();
        
        if (!this.isPaused) {
          requestAnimationFrame(this.animate.bind(this));
        }
      }
    }

    // Инициализация игры после загрузки DOM
    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('gameCanvas');
      new Game(canvas);
    });
  </script>
</body>
</html>